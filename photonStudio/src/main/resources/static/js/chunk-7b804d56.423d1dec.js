(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b804d56"],{"00d2":function(t,e,n){"use strict";n.d(e,"d",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"e",(function(){return r})),n.d(e,"a",(function(){return i})),n.d(e,"f",(function(){return c})),n.d(e,"b",(function(){return l}));var a=n("b775");function o(t,e){return Object(a["a"])({url:"zsqy/images/".concat(t,"/findAll"),method:"get",params:{imgname:e}})}function s(t){return Object(a["a"])({url:"zsqy/sub/".concat(t,"/findAll"),method:"get"})}function r(t,e,n,o){return Object(a["a"])({url:"zsqy/subinfo/".concat(t,"/findObject"),method:"get",params:{pageCurrent:e,pageSize:n,subid:o}})}function i(t,e){return Object(a["a"])({url:"zsqy/subinfo/".concat(t,"/save"),method:"post",data:e})}function c(t,e){return Object(a["a"])({url:"zsqy/subinfo/".concat(t,"/update"),method:"put",data:e})}function l(t,e){return Object(a["a"])({url:"zsqy/subinfo/".concat(t,"/delete"),method:"delete",params:{ids:e}})}},"1f5f":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return s}));var a=n("b775");function o(t,e){return Object(a["a"])({url:"/canvas/insertOrUpdate",method:"post",data:e,headers:{database:t}})}function s(t,e){return Object(a["a"])({url:"/canvas/getByPicId",method:"post",data:e,headers:{database:t}})}},"1f67":function(t,e,n){},"2e83":function(t,e,n){},3599:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("Toolbar",{ref:"toolbarRef"}),t._v(" "),n("main",[n("section",{class:t.leftShow?"left":"left t-left"},[n("ComponentList")],1),t._v(" "),n("div",{class:t.leftShow?"switch":"switch t-switch",on:{click:t.switchleft}},[n("i",{class:t.leftShow?"el-icon-arrow-left":"el-icon-arrow-right"})]),t._v(" "),n("section",{class:t.centerClass},[t._m(0)]),t._v(" "),n("section",{staticClass:"right t-right'"},[t.curComponent?n("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"属性",name:"attr"}},[n("AttrList")],1),t._v(" "),n("el-tab-pane",{attrs:{label:"事件",name:"events"}},[n("EventList")],1)],1):n("CanvasAttr")],1)])],1)},o=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content"},[n("canvas",{attrs:{id:"canvas"}})])}],s=(n("8e6e"),n("456d"),n("ac6a"),n("ade3")),r=n("2f62"),i=n("e767"),c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"toolbar"},[n("el-select",{attrs:{placeholder:"请选择页面",size:"mini"},on:{change:t.changePage},model:{value:t.pageName,callback:function(e){t.pageName=e},expression:"pageName"}},t._l(t.pageList,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value,disabled:t.disabled}})})),1),t._v(" "),n("el-button",{attrs:{type:"success",size:"mini"},on:{click:t.save}},[t._v("保存")]),t._v(" "),n("el-button",{attrs:{type:"danger",size:"mini"},on:{click:t.remove}},[t._v("删除组件")]),t._v(" "),n("el-popconfirm",{attrs:{title:"确定清空画布吗？","confirm-button-text":"确定","cancel-button-text":"等等吧",icon:"el-icon-info","icon-color":"red"},on:{confirm:t.clearCanvas}},[n("el-button",{attrs:{slot:"reference",size:"mini",type:"warning"},slot:"reference"},[t._v("\n        清空画布\n      ")])],1)],1)])},l=[],u=(n("96cf"),n("1da1")),v=n("967e"),m=n.n(v),d=n("1f5f"),f=n("1379"),p=n("5c37");function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){Object(s["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var g={components:{},data:function(){return{pageId:1,pageName:"",pageList:[{value:1,label:"首页"},{value:2,label:"demo"},{value:3,label:"测试"},{value:4,label:"展示页",disabled:!0}]}},computed:b(b({},Object(r["c"])({canvas:function(t){return t.canvas.canvas},canvasStyleData:function(t){return t.canvas.canvasStyleData},componentData:function(t){return t.canvas.componentData},canvasSerialize:function(t){return t.canvas.canvasSerialize},curComponent:function(t){return t.canvas.curComponent},curTarget:function(t){return t.canvas.curTarget}})),Object(r["b"])({path:"path",projectId:"projectId"})),created:function(){},methods:{changePage:function(t){this.clearCanvas(),this.pageId=t,this.$store.commit("canvas/changePage",this.pageId),this.getCanvasStyleByPicId(this.pageId)},save:function(){this.pageId?(this.toJson(),this.insertOrUpdateCanvasStyle()):this.$message.error("请选择页面!")},toJson:function(){console.log(this.canvas),console.log(this.canvas.toObject(this.canvas,"mouseover"));var t=this.canvas.toJSON(["customId"]);this.$store.commit("canvas/setCanvasSerialize",t)},remove:function(){var t=this;if(console.log("删除组件"),this.curTarget&&(this.canvas.remove(this.curTarget),this.canvas.requestRenderAll(),this.$store.commit("canvas/setCurTarget",null)),this.canvas.getActiveObject()){var e=this.canvas.getActiveObject();this.canvas.remove(e),this.canvas.requestRenderAll(),this.$store.commit("canvas/setCurTarget",null)}this.curComponent&&this.componentData.some((function(e,n){if(e.id==t.curComponent.id)return t.$store.commit("canvas/deleteComponent",n),!0}))},insertOrUpdateCanvasStyle:function(){var t=Object(u["a"])(m.a.mark((function t(){var e,n,a,o;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={appId:this.projectId,picId:this.pageId,canvasStyle:JSON.stringify(this.canvasStyleData),canvasData:JSON.stringify(this.componentData),canvasSerialize:JSON.stringify(this.canvasSerialize)},t.next=3,Object(d["b"])(this.path,this.$formatJson(e));case 3:n=t.sent,a=n||{},o=a.status,a.message,2e4===o&&this.$message.success("保存成功");case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getCanvasStyleByPicId:function(){var t=Object(u["a"])(m.a.mark((function t(e){var n,a,o,s,r,i;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={picId:e},t.next=3,Object(d["a"])(this.path,this.$formatJson(n));case 3:a=t.sent,o=a.data||{},o.id,o.appId,o.picId,s=o.canvasStyle,r=o.canvasData,i=o.canvasSerialize,s&&r&&i&&this.restore(s,r,i);case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),restore:function(t,e,n){var a=this,o=JSON.parse(t)||{},s=JSON.parse(e)||[],r=JSON.parse(n)||[];this.$store.commit("canvas/setCanvasStyle",o),this.$store.commit("canvas/setComponentData",s),this.$store.commit("canvas/setCanvasSerialize",r),this.canvas.loadFromJSON(r),this.canvas.loadFromJSON(r,this.canvas.renderAll.bind(this.canvas),(function(t,e){s.forEach((function(n){if(n.id===t.customId){var o=Object.keys(n.events);o.length>0&&o.forEach((function(o){"mouseover"==o&&(e.on("mouseover",(function(t){var e=t.target;e&&(e.set(n.events[o]),a.canvas.renderAll())})),e.on("mouseout",(function(e){var n=e.target;n&&(n.set(b({},t)),a.canvas.renderAll())}))),"mousedown"==o&&(console.log(n.events,"mousedownmousedownmousedown"),console.log(n.events.mousedown.eventName,"mousedownmousedownmousedown"))}))}}))}))},clearCanvas:function(){this.$store.commit("canvas/setCanvasStyle",f["c"]),this.$store.commit("canvas/setCurComponent",{component:null,index:null}),this.$store.commit("canvas/setComponentData",[]),this.$store.commit("canvas/setCanvasSerialize",null),this.canvas.clear()}},destroyed:function(){this.clearCanvas()}},y=g,O=(n("7866"),n("96db"),n("2877")),C=Object(O["a"])(y,c,l,!1,null,"c93de19e",null),j=C.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"attr-list"},[t.curComponent?n("div",{staticClass:"sign"},[t.curComponent.sign?t._e():n("el-form",{attrs:{"label-width":"70px"}},[t._l(t.styleKeys,(function(e,a){var o=e.key,s=e.label;return n("el-form-item",{key:a,attrs:{label:s}},["fill"===o||"stroke"===o?n("el-color-picker",{model:{value:t.curComponent.style[o],callback:function(e){t.$set(t.curComponent.style,o,e)},expression:"curComponent.style[key]"}}):n("el-input",{attrs:{type:"number"},model:{value:t.curComponent.style[o],callback:function(e){t.$set(t.curComponent.style,o,t._n(e))},expression:"curComponent.style[key]"}})],1)})),t._v(" "),"c-polygon"===t.curComponent.component?n("el-form-item",[n("el-button",{attrs:{type:"danger"},on:{click:t.changestatus}},[t._v("\n          切换编辑状态\n        ")])],1):t._e(),t._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:t.renderCanvas}},[t._v("\n          重新渲染组件\n        ")])],1),t._v(" "),n("el-form-item",[n("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.showAllData}},[t._v("\n          页面JSON数据\n        ")])],1)],2)],1):t._e(),t._v(" "),n("el-dialog",{attrs:{title:"页面JSON数据","append-to-body":"",visible:t.allData.visible,width:"80%"},on:{"update:visible":function(e){return t.$set(t.allData,"visible",e)}}},[n("div",{staticClass:"json-data"},[n("div",{staticClass:"json-data-left"},[n("json-editor",{model:{value:t.componentData,callback:function(e){t.componentData=e},expression:"componentData"}})],1),t._v(" "),n("div",{staticClass:"json-data-center"},[n("json-editor",{model:{value:t.curComponent,callback:function(e){t.curComponent=e},expression:"curComponent"}})],1),t._v(" "),n("div",{staticClass:"json-data-right"},[n("json-editor",{model:{value:t.curTarget,callback:function(e){t.curTarget=e},expression:"curTarget"}})],1)])])],1)},w=[],S=(n("6c7b"),n("6762"),n("2fdb"),n("fa7e"));function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){Object(s["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var x={components:{JsonEditor:S["a"]},data:function(){return{baseUrl:this.global.baseUrl,styleData:[{key:"fill",label:"填充色"},{key:"stroke",label:"边框色"},{key:"strokeWidth",label:"边框宽度"},{key:"opacity",label:"透明度"}],pointIndex:0,allData:{visible:!1,value:""}}},computed:D(D(D({},Object(r["c"])({canvas:function(t){return t.canvas.canvas},componentData:function(t){return t.canvas.componentData},curComponent:function(t){return t.canvas.curComponent},curComponentIndex:function(t){return t.canvas.curComponentIndex},curTarget:function(t){return t.canvas.curTarget}})),Object(r["b"])(["path"])),{},{styleKeys:function(){if(this.$store.state.canvas.curComponent){var t=Object.keys(this.$store.state.canvas.curComponent.style);return this.styleData.filter((function(e){return t.includes(e.key)}))}return[]}}),created:function(){},methods:{showAllData:function(){this.allData.visible=!0},renderCanvas:function(){var t=this.canvas.getActiveObject(),e={fill:this.curComponent.style.fill,stroke:this.curComponent.style.stroke,strokeWidth:this.curComponent.style.strokeWidth,opacity:this.curComponent.style.opacity};t.set(e),this.canvas.renderAll();var n=this.componentData;n[this.curComponentIndex]=this.curComponent,this.$store.commit("canvas/setComponentData",n)},changestatus:function(){this.Edit()},polygonPositionHandler:function(t,e,n){var a=n.points[this.pointIndex].x-n.pathOffset.x,o=n.points[this.pointIndex].y-n.pathOffset.y;return this.pointIndex==this.curTarget.points.length-1?this.pointIndex=0:this.pointIndex++,fabric.util.transformPoint({x:a,y:o},fabric.util.multiplyTransformMatrices(n.canvas.viewportTransform,n.calcTransformMatrix()))},getObjectSizeWithStroke:function(t){var e=new fabric.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new fabric.Point(t.width+e.x,t.height+e.y)},actionHandler:function(t,e,n,a){var o=e.target,s=o.controls[o.__corner],r=o.toLocalPoint(new fabric.Point(n,a),"center","center"),i=this.getObjectSizeWithStroke(o),c=o._getTransformedDimensions(0,0),l={x:r.x*i.x/c.x+o.pathOffset.x,y:r.y*i.y/c.y+o.pathOffset.y};return o.points[s.pointIndex]=l,!0},anchorWrapper:function(t,e){var n=this;return function(a,o,s,r){var i=o.target,c=fabric.util.transformPoint({x:i.points[t].x-i.pathOffset.x,y:i.points[t].y-i.pathOffset.y},i.calcTransformMatrix()),l=e(a,o,s,r),u=(i._setPositionDimensions({}),n.getObjectSizeWithStroke(i)),v=(i.points[t].x-i.pathOffset.x)/u.x,m=(i.points[t].y-i.pathOffset.y)/u.y;return i.setPositionByOrigin(c,v+.5,m+.5),l}},Edit:function(){var t=this,e=this.canvas.getActiveObject();if(e.edit=!e.edit,e.edit){var n=e.points.length-1;e.cornerColor="red",e.controls=e.points.reduce((function(e,a,o){return e["p"+o]=new fabric.Control({positionHandler:t.polygonPositionHandler,actionHandler:t.anchorWrapper(o>0?o-1:n,t.actionHandler),actionName:"modifyPolygon",pointIndex:o}),e}),{})}else e.cornerColor="#59c7f9",e.controls=fabric.Object.prototype.controls;e.hasBorders=!e.edit,this.canvas.requestRenderAll()}}},P=x,$=(n("d220"),Object(O["a"])(P,k,w,!1,null,"5f995ad7",null)),I=$.exports,E=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"attr-container"},[n("p",{staticClass:"title"},[t._v("画布属性")]),t._v(" "),n("el-form",{staticStyle:{padding:"20px"}},t._l(Object.keys(t.options),(function(e,a){return n("el-form-item",{key:a,attrs:{label:t.options[e]}},["zoom"===e?n("el-slider",{staticStyle:{"margin-left":"50px",width:"120px"},attrs:{min:50},on:{change:t.changeCanvasZoom},model:{value:t.canvasStyleData.zoom,callback:function(e){t.$set(t.canvasStyleData,"zoom",e)},expression:"canvasStyleData.zoom"}}):"width"===e||"height"===e?n("el-input",{staticStyle:{width:"100px"},attrs:{type:"number"},model:{value:t.canvasStyleData[e],callback:function(n){t.$set(t.canvasStyleData,e,t._n(n))},expression:"canvasStyleData[key]"}}):"backgroundType"===e?n("el-select",{staticStyle:{width:"130px"},attrs:{placeholder:"请选择背景类型"},model:{value:t.canvasStyleData.backgroundType,callback:function(e){t.$set(t.canvasStyleData,"backgroundType",e)},expression:"canvasStyleData.backgroundType"}},t._l(t.backgroundTypeList,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1):t._e(),t._v(" "),"backgroundColor"===e&&t.canvasStyleData.backgroundType===t.backgroundTypeEnmu.backgroundColor?n("el-color-picker",{attrs:{"show-alpha":"",predefine:t.predefineColors},on:{change:t.changeBgColor},model:{value:t.canvasStyleData.backgroundColor,callback:function(e){t.$set(t.canvasStyleData,"backgroundColor",e)},expression:"canvasStyleData.backgroundColor"}}):t._e(),t._v(" "),"backgroundImage"===e&&t.canvasStyleData.backgroundType===t.backgroundTypeEnmu.backgroundImage?n("el-button",{attrs:{plain:"",size:"mini"},on:{click:function(e){return t.chooseImg(2)}}},[t._v("\n        背景图\n      ")]):t._e(),t._v(" "),"allData"===e?n("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.showAllData}},[t._v("\n        页面JSON数据\n      ")]):t._e()],1)})),1),t._v(" "),n("el-dialog",{attrs:{title:"选择背景图","append-to-body":"",visible:t.imgObj.visible,width:"60%"},on:{"update:visible":function(e){return t.$set(t.imgObj,"visible",e)}}},[n("div",{staticClass:"imgbox-search"},[n("el-input",{staticClass:"imgbox-search-input",attrs:{clearable:"",placeholder:"请输入图片名称"},model:{value:t.imgObj.imgname,callback:function(e){t.$set(t.imgObj,"imgname",e)},expression:"imgObj.imgname"}})],1),t._v(" "),n("div",{staticClass:"imgbox"},[n("el-radio-group",{model:{value:t.imgObj.choseImgId,callback:function(e){t.$set(t.imgObj,"choseImgId",e)},expression:"imgObj.choseImgId"}},t._l(t.imgObj.imgList,(function(e,a){return n("div",{key:a,staticClass:"imgbox-type"},[0!=e.length?n("p",{staticClass:"imgbox-title"},[t._v("\n            "+t._s(e[0].type)+"\n          ")]):t._e(),t._v(" "),t._l(e,(function(e,a){return n("el-radio",{key:a,staticClass:"imgbox-radio",attrs:{label:e.id}},[n("img",{staticClass:"imgbox-radio-img",attrs:{src:t.baseUrl+e.url}}),t._v(" "),n("div",{staticClass:"imgbox-radio-tit"},[t._v(t._s(e.value))])])}))],2)})),0)],1),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.clearBgImg()}}},[t._v("\n        清空背景图\n      ")]),t._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:function(e){t.imgObj.visible=!1}}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.selectImg}},[t._v("\n        确 定\n      ")])],1)]),t._v(" "),n("el-dialog",{attrs:{title:"页面JSON数据","append-to-body":"",visible:t.allData.visible,width:"80%"},on:{"update:visible":function(e){return t.$set(t.allData,"visible",e)}}},[n("div",{staticClass:"json-data"},[n("div",{staticClass:"json-data-left"},[n("json-editor",{model:{value:t.canvasStyleData,callback:function(e){t.canvasStyleData=e},expression:"canvasStyleData"}})],1),t._v(" "),n("div",{staticClass:"json-data-center"},[n("json-editor",{model:{value:t.componentData,callback:function(e){t.componentData=e},expression:"componentData"}})],1),t._v(" "),n("div",{staticClass:"json-data-right"},[n("json-editor",{model:{value:t.canvasSerialize,callback:function(e){t.canvasSerialize=e},expression:"canvasSerialize"}})],1)])])],1)},z=[],A=n("00d2");function T(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function N(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?T(Object(n),!0).forEach((function(e){Object(s["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var W={components:{JsonEditor:S["a"]},data:function(){return{backgroundTypeList:f["b"],backgroundTypeEnmu:f["a"],baseUrl:this.global.baseUrl,options:{zoom:"比例",width:"宽度",height:"高度",backgroundType:"背景类型",backgroundColor:"背景色",backgroundImage:"背景图",allData:"页面数据"},imgObj:{visible:!1,imgList:[],choseImgId:0,imgname:""},allData:{visible:!1,value:""},predefineColors:["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsv(51, 100, 98)","hsva(120, 40, 94, 0.5)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"]}},computed:N(N({},Object(r["c"])({canvas:function(t){return t.canvas.canvas},canvasStyleData:function(t){return t.canvas.canvasStyleData},componentData:function(t){return t.canvas.componentData},canvasSerialize:function(t){return t.canvas.canvasSerialize}})),Object(r["b"])({path:"path"})),created:function(){},methods:{showAllData:function(){this.allData.visible=!0},changeBgColor:function(t){console.log(t),this.canvas.backgroundColor=t,this.canvas.renderAll()},chooseImg:function(t){this.imgObj.visible=!0,this.imgObj.choseImgId=0,this.getAllimageApi()},getAllimageApi:function(){var t=[];Object(A["d"])(this.path,this.imgObj.imgname).then((function(e){var n=[],a=[],o=e.data||[];o.forEach((function(t){if("material"===t.imgtype){var e={id:t.imgid,value:t.imgname,url:t.imgurl,type:"素材"};n.push(e)}else{var o={id:t.imgid,value:t.imgname,url:t.imgurl,type:"其他"};a.push(o)}})),t.push(n),t.push(a)})).catch(console.log),this.imgObj.imgList=t},selectImg:function(){var t=this;this.$message.success("图片选择成功!");var e=this.imgObj.imgList,n={};e.forEach((function(e){e.forEach((function(e){t.imgObj.choseImgId==e.id&&(n=e)}))})),this.canvas.setBackgroundImage(this.baseUrl+n.url,this.canvas.renderAll.bind(this.canvas)),this.$store.commit("canvas/setCanvasStyle",N(N({},this.canvasStyleData),{},{backgroundImage:n.url})),this.imgObj.visible=!1},clearBgImg:function(){this.canvas.setBackgroundImage("",this.canvas.renderAll.bind(this.canvas)),this.$store.commit("canvas/setCanvasStyle",N(N({},this.canvasStyleData),{},{backgroundImage:""}))},changeCanvasZoom:function(t){console.log(t,"zoom"),this.canvas.setZoom(t/100)}}},J=W,M=(n("5f54"),Object(O["a"])(J,E,z,!1,null,null,null)),L=M.exports,B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"event-list"},[n("div",{staticClass:"event-tag"},t._l(Object.keys(t.curComponent.events),(function(e){return n("el-tag",{key:e,attrs:{closable:""},on:{close:function(n){return t.removeEvent(e)}}},[t._v("\n      "+t._s(e)+"\n    ")])})),1),t._v(" "),n("div",{staticClass:"attr-list"},[n("el-alert",{attrs:{title:"组件MouseOver样式",type:"success",closable:!1}}),t._v(" "),n("br"),t._v(" "),t.curComponent?n("el-form",{attrs:{"label-width":"70px"}},[n("el-form-item",{attrs:{label:"填充色"}},[n("el-color-picker",{model:{value:t.hoverStyle.fill,callback:function(e){t.$set(t.hoverStyle,"fill",e)},expression:"hoverStyle.fill"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"边框色"}},[n("el-color-picker",{model:{value:t.hoverStyle.stroke,callback:function(e){t.$set(t.hoverStyle,"stroke",e)},expression:"hoverStyle.stroke"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"边框宽度"}},[n("el-input",{attrs:{type:"number"},model:{value:t.hoverStyle.strokeWidth,callback:function(e){t.$set(t.hoverStyle,"strokeWidth",t._n(e))},expression:"hoverStyle.strokeWidth"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"透明度"}},[n("el-input",{attrs:{type:"number"},model:{value:t.hoverStyle.opacity,callback:function(e){t.$set(t.hoverStyle,"opacity",t._n(e))},expression:"hoverStyle.opacity"}})],1),t._v(" "),n("el-form-item")],1):t._e(),t._v(" "),n("div",{staticClass:"hoverbox"},[n("el-button",{attrs:{size:"mini",type:"success"},on:{click:t.addMouseOverEvent}},[t._v("\n        添加hover事件\n      ")])],1)],1),t._v(" "),n("el-divider"),t._v(" "),n("div",{staticClass:"div-events attr-list"},[n("el-alert",{attrs:{title:"组件MouseDown事件",type:"success",closable:!1}}),t._v(" "),n("br"),t._v(" "),t.curComponent?n("el-form",{attrs:{"label-width":"70px"}},[n("el-form-item",{attrs:{label:"事件类型"}},[n("el-select",{attrs:{placeholder:"请选择事件类型"},model:{value:t.eventsModel.eventName,callback:function(e){t.$set(t.eventsModel,"eventName",e)},expression:"eventsModel.eventName"}},t._l(t.mousedownEventsType,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),n("el-form-item",{attrs:{label:"事件参数"}},[n("el-input",{model:{value:t.eventsModel.eventPara,callback:function(e){t.$set(t.eventsModel,"eventPara",e)},expression:"eventsModel.eventPara"}})],1),t._v(" "),n("el-form-item")],1):t._e(),t._v(" "),n("el-button",{attrs:{size:"mini",type:"success"},on:{click:t.addMouseDownEvent}},[t._v("\n      添加事件\n    ")])],1)],1)},H=[],R=(n("ba16"),{components:{},data:function(){return{hoverStyle:{fill:"#ebe9e9",stroke:"#b1a7a7",strokeWidth:1,opacity:1},mousedownEventsType:p["b"],mousedownEvents:p["a"],eventsModel:{eventName:null,eventPara:null}}},computed:Object(r["c"])({canvas:function(t){return t.canvas.canvas},curComponent:function(t){return t.canvas.curComponent},componentData:function(t){return t.canvas.componentData}}),watch:{},methods:{addMouseOverEvent:function(){var t=this,e=this.canvas.getActiveObject(),n=this.curComponent.style,a="mouseover",o={fill:this.hoverStyle.fill,stroke:this.hoverStyle.stroke,strokeWidth:this.hoverStyle.strokeWidth,opacity:this.hoverStyle.opacity};e.on("mouseover",(function(e){var n=e.target;n&&(n.set(o),t.canvas.renderAll())})),e.on("mouseout",(function(e){var a=e.target;a&&(a.set({fill:n.fill,stroke:n.stroke,strokeWidth:n.strokeWidth,opacity:n.opacity}),t.canvas.renderAll())})),this.$store.commit("canvas/addEvent",{event:a,param:o});var s=this.componentData;s.some((function(e){e.id===t.curComponent.id&&(e.events[a]=o)})),this.$store.commit("canvas/setComponentData",s),this.$message.info("添加mouseover事件成功")},removeMouseOverEvent:function(){var t=this.canvas.getActiveObject();t.off("mouseover"),t.off("mouseout")},addMouseDownEvent:function(){var t=this;console.log("添加mousedown事件");var e="mousedown",n=this.eventsModel,a=this.canvas.getActiveObject();a.lockMovementX=!0,a.lockMovementY=!0,a.on(e,(function(e){t.mousedownEvents[n.eventName](n.eventPara)})),this.$store.commit("canvas/addEvent",{event:e,param:n});var o=this.componentData;o.some((function(a){a.id===t.curComponent.id&&(a.events[e]=n)})),this.$store.commit("canvas/setComponentData",o),this.$message.info("添加mousedown事件成功")},removeMouseDownEvent:function(){this.canvas.getActiveObject()},removeEvent:function(t){var e=this;this.removeMouseOverEvent(),this.removeMouseDownEvent();var n=this.componentData;n.some((function(n){if(n.id===e.curComponent.id)return Reflect.deleteProperty(n.events,t),!0})),this.$store.commit("canvas/setComponentData",n),this.$store.commit("canvas/removeEvent",t)}},created:function(){var t={fill:this.curComponent.style.fill,stroke:this.curComponent.style.stroke,strokeWidth:this.curComponent.style.strokeWidth,opacity:this.curComponent.style.opacity};this.hoverStyle=t}}),U=R,q=(n("b55c"),n("a697"),Object(O["a"])(U,B,H,!1,null,"6199b4d8",null)),Z=q.exports,F=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"component-list"},[n("div",{staticClass:"tab-list"},t._l(t.canvasComponentList,(function(e,a){return n("div",{key:a,staticClass:"tab-list-data"},[n("div",{staticClass:"data-box",attrs:{draggable:"","data-component":e.component},on:{dragstart:function(n){return t.handleDragStart(n,e)}}},[n("div",{staticClass:"data-box-tit"},[t._v(t._s(e.label))]),t._v(" "),n("img",{staticClass:"data-box-img",attrs:{src:e.icon,alt:"",draggable:"","data-component":e.component}})])])})),0)])},X=[];function Y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function K(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Y(Object(n),!0).forEach((function(e){Object(s["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var V={statefullCache:!0,perPixelTargetFind:!0,transparentCorners:!0,cornerStyle:"circle",cornerSize:8,cornerColor:"#59c7f9",borderColor:"#59c7f9",fill:"#ebe9e9",strokeWidth:1,stroke:"#b1a7a7",opacity:1},G=[{component:"c-polygon",label:"多边形",events:{},style:K(K({},V),{},{objectCaching:!1}),points:[{x:125,y:323},{x:183,y:289},{x:193,y:311},{x:225,y:311},{x:284,y:311},{x:284,y:357},{x:219,y:380},{x:114,y:388}]},{component:"c-rect",label:"矩形",events:{},style:K(K({},V),{},{width:80,height:80})},{component:"c-triangle",label:"三角形",events:{},style:K(K({},V),{},{width:80,height:80})},{component:"c-circle",label:"圆形",events:{},style:K(K({},V),{},{radius:40})}],Q={data:function(){return{canvasComponentList:G}},methods:{handleDragStart:function(t){t.dataTransfer.setData("component",t.target.dataset.component)}},created:function(){}},tt=Q,et=(n("43d2f"),Object(O["a"])(tt,F,X,!1,null,"4761301f",null)),nt=et.exports,at=n("4b57"),ot=n("6acd");function st(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function rt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?st(Object(n),!0).forEach((function(e){Object(s["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):st(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var it={components:{Toolbar:j,AttrList:I,CanvasAttr:L,EventList:Z,ComponentList:nt},data:function(){return{activeName:"attr",leftShow:!0}},computed:rt(rt({},Object(r["c"])({pageId:function(t){return t.canvas.pageId},canvas:function(t){return t.canvas.canvas},canvasStyleData:function(t){return t.canvas.canvasStyleData},componentData:function(t){return t.canvas.componentData},canvasSerialize:function(t){return t.canvas.canvasSerialize},curComponent:function(t){return t.canvas.curComponent}})),{},{centerClass:function(){var t="",e=!1;return this.curComponent&&(e=!0),this.leftShow&&e&&(t="center r-center"),this.leftShow&&!e&&(t="center r-center"),!this.leftShow&&e&&(t="center  l-center r-center"),this.leftShow||e||(t="center  l-center r-center"),t}}),watch:{},created:function(){},mounted:function(){this.init()},methods:{switchleft:function(){this.leftShow=!this.leftShow},init:function(){window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var t=new i["fabric"].Canvas("canvas",{width:1920,height:1080,selection:!1,includeDefaultValues:!1});this.$store.commit("canvas/setCanvas",t),this.addDropEventListing(),this.addEventListing()},addDropEventListing:function(){var t=this;this.canvas.on("drop",(function(e){if(t.pageId){var n,a=e.e.dataTransfer.getData("component");G.forEach((function(t){t.component==a&&(n=t)}));var o={left:t.canvas.getSelectionElement().getBoundingClientRect().left,top:t.canvas.getSelectionElement().getBoundingClientRect().top},s={x:e.e.x-o.left,y:e.e.y-o.top},r=t.canvas.restorePointerVpt(s),i=JSON.parse(JSON.stringify(n));i.id||(i.id=Object(ot["a"])()),t.$store.commit("canvas/addComponent",{component:i}),t.createRect(r.y,r.x,i)}else t.$message.error("请选择页面!")}))},addEventListing:function(){var t=this;this.canvas.on("mouse:down",(function(e){e.target?(t.$store.commit("canvas/setCurTarget",JSON.parse(JSON.stringify(e.target))),t.$store.state.canvas.componentData.some((function(n,a){if(n.id==e.target.customId)return t.$store.commit("canvas/setCurComponent",{component:Object(at["b"])(n),index:a}),!0}))):(t.$store.commit("canvas/setCurComponent",{component:null,index:null}),t.$store.commit("canvas/setCurTarget",null))})),this.canvas.on("mouse:move",(function(t){})),this.canvas.on("mouse:up",(function(t){}))},createRect:function(t,e,n){switch(n.component){case"c-rect":var a=new i["fabric"].Rect(rt(rt({top:t,left:e},n.style),{},{customId:n.id}));console.log(rt(rt({top:t,left:e},n.style),{},{customId:n.id}),"rectObj"),this.canvas.add(a);break;case"c-triangle":this.canvas.add(new i["fabric"].Triangle(rt(rt({top:t,left:e},n.style),{},{customId:n.id})));break;case"c-circle":this.canvas.add(new i["fabric"].Circle(rt(rt({top:t,left:e},n.style),{},{customId:n.id})));break;case"c-polygon":var o=new i["fabric"].Polygon(n.points,rt(rt({top:t,left:e},n.style),{},{customId:n.id}));o.perPixelTargetFinds=!0,this.canvas.add(o);break}}}},ct=it,lt=(n("ba3d"),Object(O["a"])(ct,a,o,!1,null,null,null));e["default"]=lt.exports},"36b1":function(t,e,n){},"36bd":function(t,e,n){"use strict";var a=n("4bf8"),o=n("77f1"),s=n("9def");t.exports=function(t){var e=a(this),n=s(e.length),r=arguments.length,i=o(r>1?arguments[1]:void 0,n),c=r>2?arguments[2]:void 0,l=void 0===c?n:o(c,n);while(l>i)e[i++]=t;return e}},"43d2f":function(t,e,n){"use strict";n("8ab5")},5:function(t,e){},"5c37":function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return s}));n("6b54");var a=function(t){return t.perPixelTargetFind=!0,t.hasBorders=!1,t.hasControls=!1,t.hoverCursor="pointer",t.lockMovementX=!0,t.lockMovementY=!0,t.lockRotation=!0,t.lockScalingX=!0,t.lockScalingY=!0,t},o=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,{redirect:function(t){var e=/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;e.test(t)?window.open(t,"_blank"):this.$router.push(t)},alert:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){alert("提示"+t)})),log:function(t){console.log("打印日志"+t)}}),s=[{label:"跳转事件",value:"redirect"},{label:"提示",value:"alert"},{label:"日志",value:"log"}]},"5f54":function(t,e,n){"use strict";n("2e83")},6:function(t,e){},"6c7b":function(t,e,n){var a=n("5ca1");a(a.P,"Array",{fill:n("36bd")}),n("9c6c")("fill")},"6e6e":function(t,e,n){},7:function(t,e){},7866:function(t,e,n){"use strict";n("c714")},"8ab5":function(t,e,n){},"96db":function(t,e,n){"use strict";n("6e6e")},a697:function(t,e,n){"use strict";n("f3c6")},b55c:function(t,e,n){"use strict";n("1f67")},ba16:function(t,e,n){var a=n("5ca1"),o=n("11e9").f,s=n("cb7c");a(a.S,"Reflect",{deleteProperty:function(t,e){var n=o(s(t),e);return!(n&&!n.configurable)&&delete t[e]}})},ba3d:function(t,e,n){"use strict";n("36b1")},c714:function(t,e,n){},d220:function(t,e,n){"use strict";n("fe4c")},f3c6:function(t,e,n){},fe4c:function(t,e,n){}}]);